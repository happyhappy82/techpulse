---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import ProductCard from '../components/ProductCard.astro';
import { getCollection } from 'astro:content';

// ëª¨ë“  ë¦¬ë·° ê°€ì ¸ì˜¤ê¸°
const allReviews = await getCollection('reviews');

// featured ì œí’ˆë“¤ (ìµœì‹ ìˆœ)
const featuredReviews = allReviews
  .filter(review => review.data.featured)
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime());

// ì¹´í…Œê³ ë¦¬ë³„ ìµœì‹  ë¦¬ë·°
const laptopReviews = allReviews
  .filter(review => review.data.product.category === 'laptop')
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime())
  .slice(0, 3);

const smartphoneReviews = allReviews
  .filter(review => review.data.product.category === 'smartphone')
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime())
  .slice(0, 3);

const gadgetReviews = allReviews
  .filter(review => review.data.product.category === 'gadget')
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime())
  .slice(0, 3);

// ì´ ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜
function calculateTotalScore(scores: any) {
  const { performance, design, display, battery, value } = scores;
  // displayê°€ 0ì´ë©´ (ì´ì–´í° ë“±) ì œì™¸í•˜ê³  í‰ê·  ê³„ì‚°
  if (display === 0) {
    return Math.round((performance + design + battery + value) / 4);
  }
  return Math.round((performance + design + display + battery + value) / 5);
}

// ë©”íƒ€ ì •ë³´
const title = 'TechPulse - ê¸°ìˆ ì˜ ë§¥ë°•ì„ ëŠë¼ë‹¤';
const description = 'ìµœì‹  ì „ìì œí’ˆ ë¦¬ë·°ì™€ ë¹„êµ ë¶„ì„. ë…¸íŠ¸ë¶, ìŠ¤ë§ˆíŠ¸í°, ê°€ì ¯ì˜ ì†”ì§í•œ í‰ê°€ì™€ ìµœì €ê°€ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.';
---

<BaseLayout title={title} description={description}>
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">
          <span class="hero-title-main">ê¸°ìˆ ì˜ ë§¥ë°•ì„ ëŠë¼ë‹¤</span>
          <span class="hero-title-sub">TechPulse</span>
        </h1>
        <p class="hero-description">
          ìµœì‹  ì „ìì œí’ˆì˜ ì†”ì§í•œ ë¦¬ë·°ì™€ ìƒì„¸í•œ ë¹„êµ ë¶„ì„.<br />
          ë‹¹ì‹ ì˜ í˜„ëª…í•œ ì„ íƒì„ ìœ„í•œ ê°€ì¥ ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
        </p>
        <div class="hero-stats">
          <div class="stat-item">
            <span class="stat-number">{allReviews.length}+</span>
            <span class="stat-label">ë¦¬ë·°</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-number">100%</span>
            <span class="stat-label">ì†”ì§í•œ í‰ê°€</span>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-number">24ì‹œê°„</span>
            <span class="stat-label">ìµœì‹  ì •ë³´</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured Products -->
    {featuredReviews.length > 0 && (
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">ğŸ”¥ ì¶”ì²œ ì œí’ˆ</h2>
          <p class="section-description">ì „ë¬¸ê°€ê°€ ì„ ì •í•œ ì´ë‹¬ì˜ ë² ìŠ¤íŠ¸ ì œí’ˆ</p>
        </div>
        <div class="products-grid">
          {featuredReviews.map((review) => (
            <ProductCard
              slug={review.slug}
              title={review.data.title}
              productName={review.data.product.name}
              brand={review.data.product.brand}
              image={review.data.product.image}
              totalScore={calculateTotalScore(review.data.scores)}
              scores={review.data.scores}
              rank={review.data.rank}
              prices={review.data.prices}
            />
          ))}
        </div>
      </section>
    )}

    <!-- Laptops -->
    {laptopReviews.length > 0 && (
      <section class="section">
        <div class="section-header">
          <div>
            <h2 class="section-title">ğŸ’» ë…¸íŠ¸ë¶</h2>
            <p class="section-description">ìƒì‚°ì„±ì„ ë†’ì´ëŠ” ì™„ë²½í•œ ë…¸íŠ¸ë¶ ì°¾ê¸°</p>
          </div>
          <a href="/laptops" class="section-link">
            ì „ì²´ ë³´ê¸°
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {laptopReviews.map((review) => (
            <ProductCard
              slug={review.slug}
              title={review.data.title}
              productName={review.data.product.name}
              brand={review.data.product.brand}
              image={review.data.product.image}
              totalScore={calculateTotalScore(review.data.scores)}
              scores={review.data.scores}
              rank={review.data.rank}
              prices={review.data.prices}
            />
          ))}
        </div>
      </section>
    )}

    <!-- Smartphones -->
    {smartphoneReviews.length > 0 && (
      <section class="section">
        <div class="section-header">
          <div>
            <h2 class="section-title">ğŸ“± ìŠ¤ë§ˆíŠ¸í°</h2>
            <p class="section-description">ìµœì‹  ê¸°ìˆ ì´ ë‹´ê¸´ ìŠ¤ë§ˆíŠ¸í° ë¦¬ë·°</p>
          </div>
          <a href="/smartphones" class="section-link">
            ì „ì²´ ë³´ê¸°
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {smartphoneReviews.map((review) => (
            <ProductCard
              slug={review.slug}
              title={review.data.title}
              productName={review.data.product.name}
              brand={review.data.product.brand}
              image={review.data.product.image}
              totalScore={calculateTotalScore(review.data.scores)}
              scores={review.data.scores}
              rank={review.data.rank}
              prices={review.data.prices}
            />
          ))}
        </div>
      </section>
    )}

    <!-- Gadgets -->
    {gadgetReviews.length > 0 && (
      <section class="section">
        <div class="section-header">
          <div>
            <h2 class="section-title">âš¡ ê°€ì ¯</h2>
            <p class="section-description">ì¼ìƒì„ í’ìš”ë¡­ê²Œ í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ ê°€ì ¯</p>
          </div>
          <a href="/gadgets" class="section-link">
            ì „ì²´ ë³´ê¸°
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>
        <div class="products-grid">
          {gadgetReviews.map((review) => (
            <ProductCard
              slug={review.slug}
              title={review.data.title}
              productName={review.data.product.name}
              brand={review.data.product.brand}
              image={review.data.product.image}
              totalScore={calculateTotalScore(review.data.scores)}
              scores={review.data.scores}
              rank={review.data.rank}
              prices={review.data.prices}
            />
          ))}
        </div>
      </section>
    )}
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-brand-primary to-brand-secondary flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
        </div>
        <div>
          <p class="font-bold text-brand-text">TechPulse</p>
          <p class="text-small text-brand-text-secondary">ê¸°ìˆ ì˜ ë§¥ë°•</p>
        </div>
      </div>
      <p class="footer-text">
        Â© 2024 TechPulse. All rights reserved.<br />
        ì†”ì§í•œ ë¦¬ë·°ë¡œ í˜„ëª…í•œ ì„ íƒì„ ë•ìŠµë‹ˆë‹¤.
      </p>
    </div>
  </footer>
</BaseLayout>

<style>
  main {
    min-height: 60vh;
  }

  /* Hero Section */
  .hero-section {
    margin-bottom: 64px;
    padding: 48px 0;
    background: linear-gradient(135deg, #EFF6FF 0%, #F3E8FF 100%);
    border-radius: 16px;
    text-align: center;
  }

  .hero-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 24px;
  }

  .hero-title {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
  }

  .hero-title-main {
    font-size: 32px;
    font-weight: 800;
    color: var(--brand-text);
    line-height: 1.2;
  }

  .hero-title-sub {
    font-size: 48px;
    font-weight: 900;
    background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
  }

  .hero-description {
    font-size: 18px;
    color: var(--brand-text-secondary);
    margin-bottom: 32px;
    line-height: 1.6;
  }

  .hero-stats {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 24px;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .stat-number {
    font-size: 28px;
    font-weight: 800;
    color: var(--brand-primary);
  }

  .stat-label {
    font-size: 14px;
    color: var(--brand-text-secondary);
    font-weight: 500;
  }

  .stat-divider {
    width: 1px;
    height: 40px;
    background: var(--brand-border);
  }

  /* Section */
  .section {
    margin-bottom: 64px;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 24px;
  }

  .section-title {
    font-size: 28px;
    font-weight: 800;
    color: var(--brand-text);
    margin-bottom: 4px;
  }

  .section-description {
    font-size: 16px;
    color: var(--brand-text-secondary);
  }

  .section-link {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 16px;
    font-weight: 700;
    color: var(--brand-primary);
    transition: all 0.2s ease;
  }

  .section-link:hover {
    gap: 8px;
    color: var(--brand-secondary);
  }

  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
  }

  /* Footer */
  .footer {
    margin-top: 80px;
    padding: 32px 0;
    border-top: 2px solid var(--brand-border);
  }

  .footer-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    text-align: center;
  }

  .footer-logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .footer-text {
    font-size: 14px;
    color: var(--brand-text-secondary);
    line-height: 1.6;
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 768px) {
    .hero-section {
      padding: 32px 0;
      margin-bottom: 48px;
    }

    .hero-title-main {
      font-size: 24px;
    }

    .hero-title-sub {
      font-size: 36px;
    }

    .hero-description {
      font-size: 16px;
    }

    .hero-stats {
      gap: 16px;
    }

    .stat-number {
      font-size: 24px;
    }

    .stat-label {
      font-size: 12px;
    }

    .section {
      margin-bottom: 48px;
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .section-title {
      font-size: 24px;
    }

    .section-description {
      font-size: 14px;
    }

    .products-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }
  }

  @media (min-width: 769px) and (max-width: 1024px) {
    .products-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
